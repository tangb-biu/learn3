<!DOCTYPE html>
<html>
<head>
	<title>demo5</title>
	<style>
	body{
		margin: 0;
		padding: 0;
		border: none;
	}
	#J_stats_output {
		position: fixed;
		top: 20px;
		left: 50px;
		border: 1px solid blue;
	}
	</style>
</head>
<body>
<div id="J_stats_output"></div>
<script type="text/javascript" src="../lib/three.js"></script>
<script type="text/javascript" src="../lib/stats.js"></script>
<script type="text/javascript" src="../lib/dat.gui.js"></script>
<script type="text/javascript">
var Three = THREE;
// 初始化场景
var scene = new Three.Scene();
// 设置相机
var camera = new Three.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
// 设置渲染器
var renderer = new Three.WebGLRenderer();
renderer.setClearColor(0xeeeeee, 1.0);

renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true; // 是否渲染阴影
// 添加坐标轴
var axes = new Three.AxisHelper(20);
scene.add(axes);

// 添加一个平面
var planeGeometry = new Three.PlaneGeometry(60, 20);
// var planeMaterial = new Three.MeshBasicMaterial({color: 0xcccccc}); 基础材质不会对场景中的光源产生反应
var planeMaterial = new Three.MeshLambertMaterial({color: 0xcccccc}); 
var plane = new Three.Mesh(planeGeometry, planeMaterial);
plane.rotation.x = -0.5*Math.PI;
plane.position.set(15, 0 ,0);
plane.receiveShadow = true; // 投射阴影到这个平面

scene.add(plane);

// 添加一个立方体
var cubeGeometry = new Three.CubeGeometry(4, 4, 4);
var cubeMaterial = new Three.MeshLambertMaterial({
	color: 0xff0000, //wireframe: true
})
var cube = new Three.Mesh(cubeGeometry, cubeMaterial);

cube.position.set(-4, 3, 0);
cube.castShadow = true; // 产生阴影
scene.add(cube);
// 添加球体
var sphereGeometry = new Three.SphereGeometry(5, 40, 20);
var sphereMaterial = new Three.MeshLambertMaterial({
	color: 0x7777ff, wireframe: true
})
var sphere = new Three.Mesh(sphereGeometry, sphereMaterial);
sphere.position.set(20, 4, 2);
sphere.castShadow = true;
scene.add(sphere);

// 设置相机的位置
camera.position.set(-30, 40, 30);
camera.lookAt(scene.position);

// 添加光源
var splotLight = new Three.SpotLight(0xffffff);
splotLight.position.set(-40, 60, -10);
splotLight.castShadow = true;
scene.add( splotLight );


// 查看动画的帧数
var stats = new Stats();
stats.setMode(0);
document.querySelector('#J_stats_output').appendChild(stats.domElement);

// 控制绘制速度
var gui = new dat.GUI();
var controls = {
	rotationSpeed: 0.02,
	bouncingSpeed: 0.03
}
gui.add(controls, 'rotationSpeed', 0, 0.5);
gui.add(controls, 'bouncingSpeed', 0, 0.5);

// 渲染
document.body.appendChild(renderer.domElement);


var step = 0;
function renderScene() {
	stats.update();
	cube.rotation.x += controls.rotationSpeed;
	cube.rotation.y += controls.rotationSpeed;
	cube.rotation.z += controls.rotationSpeed;

	step += controls.bouncingSpeed;
	sphere.position.x = 20+(10*Math.cos(step));
	sphere.position.y = 2 + (10*Math.abs(Math.sin(step)))
	
	requestAnimationFrame(renderScene);
	renderer.render(scene, camera);
}
renderScene();

</script>
</body>
</html>